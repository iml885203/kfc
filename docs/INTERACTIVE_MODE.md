# 🎮 KFC 互動模式使用指南

## ✨ 互動式過濾功能

KFC 現在支援**即時互動式過濾**！在日誌流動時，你可以隨時調整過濾條件，無需重啟命令。

---

## ⌨️ 鍵盤快捷鍵

### **過濾控制**

| 按鍵 | 功能         | 說明                            |
| ---- | ------------ | ------------------------------- |
| `/`  | 進入過濾模式 | 輸入新的過濾模式，按 Enter 套用 |
| `c`  | 清除過濾     | 移除所有過濾條件，顯示全部日誌  |
| `i`  | 切換大小寫   | 切換是否區分大小寫              |
| `v`  | 反向匹配     | 切換顯示匹配/不匹配的行         |

### **上下文控制**

| 按鍵 | 功能       | 說明                 |
| ---- | ---------- | -------------------- |
| `+`  | 增加上下文 | 增加顯示的上下文行數 |
| `-`  | 減少上下文 | 減少顯示的上下文行數 |

### **播放控制**

| 按鍵 | 功能      | 說明             |
| ---- | --------- | ---------------- |
| `p`  | 暫停/繼續 | 暫停或繼續日誌流 |

### **其他**

| 按鍵 | 功能     | 說明               |
| ---- | -------- | ------------------ |
| `?`  | 顯示說明 | 顯示所有快捷鍵說明 |
| `q`  | 退出     | 退出 KFC           |

---

## 🎯 使用範例

### **1. 基本使用**

```bash
# 啟動 KFC
kfc -n production my-deployment

# 畫面顯示：
┌──────────────────────────────────────────────────┐
│ ● Following logs for my-deployment...            │
└──────────────────────────────────────────────────┘
Press ? for help, / to filter, q to quit

[pod/xxx/container] 日誌內容...
[pod/xxx/container] 更多日誌...
```

### **2. 即時添加過濾**

```bash
# 按 / 進入過濾模式
# 輸入: ERROR
# 按 Enter

# 畫面顯示：
┌──────────────────────────────────────────────────┐
│ ● Following logs for my-deployment... | /ERROR/  │
└──────────────────────────────────────────────────┘

> [pod/xxx/container] [ERROR] Something went wrong
> [pod/xxx/container] [ERROR] Another error
```

### **3. 調整過濾條件**

```bash
# 按 i 切換大小寫敏感
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment... | /ERROR/i    │
└──────────────────────────────────────────────────────┘

# 按 v 反向匹配（顯示不包含 ERROR 的行）
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment... | NOT /ERROR/i│
└──────────────────────────────────────────────────────┘

# 按 + 增加上下文（顯示匹配行前後各 1 行）
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment... | /ERROR/i ±1 │
└──────────────────────────────────────────────────────┘
```

### **4. 暫停和繼續**

```bash
# 按 p 暫停日誌流
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment... [PAUSED]      │
└──────────────────────────────────────────────────────┘

# 再按 p 繼續
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment...               │
└──────────────────────────────────────────────────────┘
```

### **5. 清除過濾**

```bash
# 按 c 清除所有過濾
┌──────────────────────────────────────────────────────┐
│ ● Following logs for my-deployment...               │
└──────────────────────────────────────────────────────┘

[pod/xxx/container] 所有日誌都顯示了...
```

---

## 🎨 狀態列說明

### **狀態指示器**

- `●` - 已連線
- `○` - 未連線/重連中

### **過濾資訊**

- `/pattern/` - 當前過濾模式
- `/pattern/i` - 不區分大小寫
- `NOT /pattern/` - 反向匹配
- `±N` - 顯示前後各 N 行上下文

### **模式指示**

- `[PAUSED]` - 日誌已暫停
- `[FILTER MODE]` - 正在輸入過濾條件

---

## 🔄 工作流程範例

### **除錯工作流程**

```bash
# 1. 啟動 KFC
kfc -n production api-deployment

# 2. 看到太多日誌，按 / 過濾 ERROR
/ERROR<Enter>

# 3. 發現需要看上下文，按 + 三次
+++

# 4. 想看 WARNING 也包含，按 / 修改過濾
/ERROR|WARN<Enter>

# 5. 暫停查看，按 p
p

# 6. 繼續，再按 p
p

# 7. 完成除錯，按 q 退出
q
```

### **監控工作流程**

```bash
# 1. 啟動並過濾成功的請求
kfc -n production -g "success" api-deployment

# 2. 想看失敗的請求，按 v 反向匹配
v

# 3. 想看所有請求，按 c 清除過濾
c

# 4. 只看特定用戶，按 / 輸入用戶 ID
/user_12345<Enter>

# 5. 不區分大小寫，按 i
i
```

---

## 📊 功能特點

### **即時過濾**

- ✅ 無需重啟命令
- ✅ 即時生效
- ✅ 保留歷史日誌（最多 10,000 行）
- ✅ 支援正則表達式

### **智能緩衝**

- ✅ 自動保留最近 10,000 行日誌
- ✅ 切換過濾時可重新過濾歷史日誌
- ✅ 記憶體友好

### **視覺反饋**

- ✅ 匹配行紅色 `>` 標記
- ✅ 狀態列即時更新
- ✅ 過濾模式視覺提示
- ✅ 暫停狀態顯示

---

## 🎯 進階技巧

### **1. 正則表達式過濾**

```bash
# 按 / 然後輸入正則表達式
/user.*login.*success<Enter>
/(ERROR|FATAL|CRITICAL)<Enter>
/\d{3}\.\d{3}\.\d{3}\.\d{3}<Enter>  # IP 地址
```

### **2. 組合快捷鍵**

```bash
# 過濾 + 不區分大小寫 + 上下文
/payment<Enter>
i
+++
```

### **3. 快速切換**

```bash
# 在不同過濾條件間快速切換
/ERROR<Enter>    # 看錯誤
c                # 看全部
/WARN<Enter>     # 看警告
v                # 看非警告
```

---

## 🚀 最佳實踐

### **1. 除錯時**

- 先用 `/ERROR` 找錯誤
- 用 `+` 增加上下文了解前因後果
- 用 `p` 暫停仔細查看

### **2. 監控時**

- 用 `/` 過濾關鍵指標
- 用 `i` 確保不漏掉大小寫變體
- 用 `c` 定期查看全貌

### **3. 分析時**

- 用正則表達式精確匹配
- 用 `v` 排除無關日誌
- 用上下文了解完整流程

---

## 💡 提示

1. **過濾模式**會保留最近 10,000 行日誌，切換過濾時會重新過濾這些歷史日誌
2. **暫停模式**會停止接收新日誌，但不會停止過濾功能
3. **上下文行數**最多可設定到 20 行
4. **正則表達式**錯誤會自動忽略，顯示所有日誌

---

## 🎊 開始使用

```bash
# 編譯
npm run build

# 啟動互動模式
node dist/cli.js -n production my-deployment

# 按 ? 查看說明
# 按 / 開始過濾
# 享受即時互動式日誌過濾！
```

**讓日誌分析變得更加靈活和高效！** 🚀✨
